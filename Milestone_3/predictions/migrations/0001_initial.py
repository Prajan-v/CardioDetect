# Generated by Django 6.0 on 2025-12-21 15:15

import django.core.validators
import django.db.models.deletion
import uuid
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='AuthorizedDevice',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('device_fingerprint', models.CharField(max_length=50, unique=True)),
                ('name', models.CharField(blank=True, max_length=100)),
                ('is_active', models.BooleanField(default=True)),
                ('authorized_at', models.DateTimeField(auto_now_add=True)),
                ('last_scan_at', models.DateTimeField(blank=True, null=True)),
                ('scan_count', models.IntegerField(default=0)),
                ('authorized_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-authorized_at'],
            },
        ),
        migrations.CreateModel(
            name='BarcodeScan',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('patient_id', models.CharField(max_length=50)),
                ('patient_name', models.CharField(max_length=100)),
                ('risk_level', models.CharField(max_length=20)),
                ('probability', models.FloatField(null=True)),
                ('accession_number', models.CharField(blank=True, max_length=50)),
                ('is_valid', models.BooleanField(default=True)),
                ('scanned_at', models.DateTimeField(auto_now_add=True)),
                ('barcode_version', models.IntegerField(default=3)),
                ('device', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='scans', to='predictions.authorizeddevice')),
            ],
            options={
                'ordering': ['-scanned_at'],
            },
        ),
        migrations.CreateModel(
            name='MedicalDocument',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('filename', models.CharField(max_length=255)),
                ('file', models.FileField(upload_to='uploads/%Y/%m/')),
                ('file_type', models.CharField(choices=[('pdf', 'PDF Document'), ('png', 'PNG Image'), ('jpg', 'JPEG Image'), ('other', 'Other')], default='other', max_length=20)),
                ('file_size', models.IntegerField(validators=[django.core.validators.MinValueValidator(0)])),
                ('ocr_status', models.CharField(choices=[('pending', 'Pending'), ('processing', 'Processing'), ('success', 'Success'), ('failed', 'Failed')], default='pending', max_length=15)),
                ('ocr_confidence', models.FloatField(default=0.0, validators=[django.core.validators.MinValueValidator(0.0), django.core.validators.MaxValueValidator(1.0)])),
                ('ocr_method', models.CharField(blank=True, max_length=50)),
                ('extracted_text', models.TextField(blank=True)),
                ('extracted_fields', models.JSONField(blank=True, default=dict)),
                ('uploaded_at', models.DateTimeField(auto_now_add=True)),
                ('processed_at', models.DateTimeField(blank=True, null=True)),
                ('processing_time_ms', models.IntegerField(blank=True, null=True)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='documents', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-uploaded_at'],
            },
        ),
        migrations.CreateModel(
            name='Prediction',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('input_method', models.CharField(choices=[('manual', 'Manual Input'), ('ocr', 'OCR Document'), ('hybrid', 'Hybrid (OCR + Manual)')], default='manual', max_length=10)),
                ('model_used', models.CharField(choices=[('detection', 'Disease Detection'), ('prediction', '10-Year Risk Prediction'), ('both', 'Both Models')], default='prediction', max_length=20)),
                ('input_data', models.JSONField(default=dict)),
                ('age', models.IntegerField(blank=True, null=True, validators=[django.core.validators.MinValueValidator(18), django.core.validators.MaxValueValidator(120)])),
                ('sex', models.IntegerField(blank=True, choices=[(0, 'Female'), (1, 'Male')], null=True)),
                ('systolic_bp', models.FloatField(blank=True, null=True, validators=[django.core.validators.MinValueValidator(70), django.core.validators.MaxValueValidator(250)])),
                ('diastolic_bp', models.FloatField(blank=True, null=True, validators=[django.core.validators.MinValueValidator(40), django.core.validators.MaxValueValidator(150)])),
                ('heart_rate', models.IntegerField(blank=True, null=True, validators=[django.core.validators.MinValueValidator(40), django.core.validators.MaxValueValidator(200)])),
                ('cholesterol', models.FloatField(blank=True, null=True, validators=[django.core.validators.MinValueValidator(100), django.core.validators.MaxValueValidator(400)])),
                ('hdl', models.FloatField(blank=True, null=True)),
                ('ldl', models.FloatField(blank=True, null=True)),
                ('triglycerides', models.FloatField(blank=True, null=True)),
                ('glucose', models.FloatField(blank=True, null=True)),
                ('smoking', models.BooleanField(blank=True, null=True)),
                ('diabetes', models.BooleanField(blank=True, null=True)),
                ('bp_medication', models.BooleanField(blank=True, null=True)),
                ('bmi', models.FloatField(blank=True, null=True, validators=[django.core.validators.MinValueValidator(15), django.core.validators.MaxValueValidator(60)])),
                ('weight', models.FloatField(blank=True, null=True)),
                ('height', models.FloatField(blank=True, null=True)),
                ('chest_pain_type', models.IntegerField(blank=True, null=True)),
                ('max_heart_rate', models.IntegerField(blank=True, null=True)),
                ('exercise_angina', models.BooleanField(blank=True, null=True)),
                ('st_depression', models.FloatField(blank=True, null=True)),
                ('st_slope', models.IntegerField(blank=True, null=True)),
                ('major_vessels', models.IntegerField(blank=True, null=True)),
                ('thalassemia', models.IntegerField(blank=True, null=True)),
                ('resting_ecg', models.IntegerField(blank=True, null=True)),
                ('risk_score', models.FloatField(blank=True, null=True, validators=[django.core.validators.MinValueValidator(0.0), django.core.validators.MaxValueValidator(1.0)])),
                ('risk_percentage', models.FloatField(blank=True, null=True)),
                ('risk_category', models.CharField(blank=True, choices=[('LOW', 'Low Risk'), ('MODERATE', 'Moderate Risk'), ('HIGH', 'High Risk')], max_length=10, null=True)),
                ('prediction_confidence', models.FloatField(blank=True, null=True)),
                ('detection_result', models.BooleanField(blank=True, null=True)),
                ('detection_probability', models.FloatField(blank=True, null=True)),
                ('detection_confidence', models.FloatField(blank=True, null=True)),
                ('clinical_score', models.IntegerField(blank=True, null=True)),
                ('clinical_max_score', models.IntegerField(blank=True, null=True)),
                ('clinical_risk_level', models.CharField(blank=True, max_length=20)),
                ('clinical_override_applied', models.BooleanField(default=False)),
                ('override_reason', models.TextField(blank=True)),
                ('original_risk_category', models.CharField(blank=True, max_length=10)),
                ('recommendations', models.TextField(blank=True)),
                ('risk_factors', models.JSONField(blank=True, default=list)),
                ('lifestyle_modifications', models.JSONField(blank=True, default=list)),
                ('follow_up_actions', models.JSONField(blank=True, default=list)),
                ('model_version', models.CharField(default='v2.0', max_length=20)),
                ('processing_time_ms', models.IntegerField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('report_generated', models.BooleanField(default=False)),
                ('report_file', models.FileField(blank=True, null=True, upload_to='reports/%Y/%m/')),
                ('document', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='predictions', to='predictions.medicaldocument')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='predictions', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Risk Prediction',
                'verbose_name_plural': 'Risk Predictions',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='PredictionNote',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('note', models.TextField()),
                ('is_private', models.BooleanField(default=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('author', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='prediction_notes', to=settings.AUTH_USER_MODEL)),
                ('prediction', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='notes', to='predictions.prediction')),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='SystemNotification',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('title', models.CharField(max_length=200)),
                ('message', models.TextField()),
                ('notification_type', models.CharField(choices=[('info', 'Information'), ('warning', 'Warning'), ('success', 'Success'), ('error', 'Error'), ('prediction', 'New Prediction')], default='info', max_length=15)),
                ('is_read', models.BooleanField(default=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('related_prediction', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='predictions.prediction')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='notifications', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='UnitPreference',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('cholesterol_unit', models.CharField(choices=[('mg/dL', 'mg/dL'), ('mmol/L', 'mmol/L')], default='mg/dL', max_length=10)),
                ('glucose_unit', models.CharField(choices=[('mg/dL', 'mg/dL'), ('mmol/L', 'mmol/L')], default='mg/dL', max_length=10)),
                ('weight_unit', models.CharField(choices=[('kg', 'Kilograms'), ('lbs', 'Pounds')], default='kg', max_length=5)),
                ('height_unit', models.CharField(choices=[('cm', 'Centimeters'), ('ft', 'Feet/Inches')], default='cm', max_length=5)),
                ('temperature_unit', models.CharField(choices=[('C', 'Celsius'), ('F', 'Fahrenheit')], default='C', max_length=5)),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='unit_preferences', to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.CreateModel(
            name='AuditLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('action', models.CharField(choices=[('create', 'Created'), ('read', 'Viewed'), ('update', 'Updated'), ('delete', 'Deleted'), ('export', 'Exported'), ('login', 'Logged In'), ('logout', 'Logged Out')], max_length=10)),
                ('resource_type', models.CharField(max_length=50)),
                ('resource_id', models.CharField(blank=True, max_length=100)),
                ('details', models.JSONField(blank=True, default=dict)),
                ('ip_address', models.GenericIPAddressField(blank=True, null=True)),
                ('user_agent', models.TextField(blank=True)),
                ('timestamp', models.DateTimeField(auto_now_add=True)),
                ('user', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='audit_logs', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-timestamp'],
                'indexes': [models.Index(fields=['user', '-timestamp'], name='predictions_user_id_7bf7c5_idx'), models.Index(fields=['resource_type', 'resource_id'], name='predictions_resourc_587683_idx')],
            },
        ),
        migrations.CreateModel(
            name='DoctorPatient',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('status', models.CharField(choices=[('pending', 'Pending Approval'), ('active', 'Active'), ('revoked', 'Access Revoked')], default='pending', max_length=10)),
                ('can_view_history', models.BooleanField(default=True)),
                ('can_add_notes', models.BooleanField(default=True)),
                ('can_modify_predictions', models.BooleanField(default=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('doctor', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='patients', to=settings.AUTH_USER_MODEL)),
                ('patient', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='doctors', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Doctor-Patient Relationship',
                'verbose_name_plural': 'Doctor-Patient Relationships',
                'unique_together': {('doctor', 'patient')},
            },
        ),
        migrations.AddIndex(
            model_name='medicaldocument',
            index=models.Index(fields=['user', '-uploaded_at'], name='predictions_user_id_e29398_idx'),
        ),
        migrations.AddIndex(
            model_name='medicaldocument',
            index=models.Index(fields=['ocr_status'], name='predictions_ocr_sta_3f7af1_idx'),
        ),
        migrations.AddIndex(
            model_name='prediction',
            index=models.Index(fields=['user', '-created_at'], name='predictions_user_id_047b4a_idx'),
        ),
        migrations.AddIndex(
            model_name='prediction',
            index=models.Index(fields=['risk_category'], name='predictions_risk_ca_3e892d_idx'),
        ),
        migrations.AddIndex(
            model_name='prediction',
            index=models.Index(fields=['created_at'], name='predictions_created_1c4dba_idx'),
        ),
        migrations.AddIndex(
            model_name='systemnotification',
            index=models.Index(fields=['user', 'is_read', '-created_at'], name='predictions_user_id_9f1f76_idx'),
        ),
    ]
